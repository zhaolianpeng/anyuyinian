# 管理员功能部署指南

## 部署步骤

### 1. 数据库迁移

首先执行数据库迁移脚本：

```bash
# 修改数据库连接信息
vim run_admin_migration.sh

# 执行迁移
chmod +x run_admin_migration.sh
./run_admin_migration.sh
```

### 2. 后端部署

#### 2.1 编译项目
```bash
go build -o main .
```

#### 2.2 运行服务
```bash
go run main.go
```

#### 2.3 验证服务
```bash
# 测试管理员登录
curl -X POST http://localhost:8080/admin/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "anyuyinian",
    "password": "000000"
  }'
```

### 3. 前端部署

#### 3.1 确保页面已注册
检查 `miniprogram/app.json` 中已包含管理员页面：
```json
{
  "pages": [
    "pages/admin/login",
    "pages/admin/home",
    "pages/admin/orders",
    "pages/admin/users"
  ]
}
```

#### 3.2 测试小程序
1. 在微信开发者工具中打开项目
2. 测试管理员登录功能
3. 验证两种登录方式

## 功能验证

### 1. 超级管理员登录测试
- 账号：anyuyinian
- 密码：000000
- 预期：登录成功，跳转到管理员首页

### 2. 普通管理员登录测试
- 已登录管理员：直接切换模式
- 已登录非管理员：提示后返回主页
- 未登录用户：调起微信登录

### 3. 权限验证测试
- 超级管理员：可以看到所有数据
- 一级管理员：只能看到自己的数据

## 常见问题

### 1. 编译错误
如果遇到 `AdminImp redeclared` 错误：
- 检查 `db/dao/admin_dao.go` 中是否有重复声明
- 确保变量名不冲突

### 2. 数据库连接错误
- 检查数据库连接配置
- 确保数据库服务正在运行
- 验证数据库用户权限

### 3. API调用失败
- 检查后端服务是否正常运行
- 验证API路径是否正确
- 检查请求参数格式

## 安全配置

### 1. 密码安全
建议在生产环境中：
- 使用bcrypt加密管理员密码
- 定期更换默认密码
- 限制登录失败次数

### 2. 权限控制
- 确保API接口有权限验证
- 记录管理员操作日志
- 定期审查管理员权限

### 3. 数据隔离
- 验证一级管理员数据隔离
- 确保超级管理员权限正确
- 测试数据访问权限

## 监控和维护

### 1. 日志监控
- 监控管理员登录日志
- 记录异常登录尝试
- 定期检查操作日志

### 2. 性能监控
- 监控API响应时间
- 检查数据库查询性能
- 监控服务器资源使用

### 3. 定期维护
- 定期备份数据库
- 更新管理员密码
- 清理过期日志

## 故障排除

### 1. 登录失败
- 检查数据库中的管理员账号
- 验证密码是否正确
- 检查网络连接

### 2. 权限问题
- 验证用户管理员状态
- 检查数据库字段是否正确
- 确认API权限验证

### 3. 数据不显示
- 检查管理员级别设置
- 验证数据权限逻辑
- 确认数据库查询正确

---

**默认管理员账号**：
- 用户名：anyuyinian
- 密码：000000

**测试命令**：
```bash
./test_admin.sh
``` 